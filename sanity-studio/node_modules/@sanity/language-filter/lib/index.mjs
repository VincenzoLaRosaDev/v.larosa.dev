import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{useState as r,createContext as o,useEffect as l,useMemo as a,useContext as i,useCallback as s}from"react";import{useClient as u,TextWithTone as c,useFormValue as d,useSchema as p,definePlugin as g,isObjectSchemaType as f}from"sanity";import{EyeClosedIcon as m,EyeOpenIcon as y,TranslateIcon as b,CheckmarkCircleIcon as h,CircleIcon as v}from"@sanity/icons";import{Box as L,useClickOutside as O,Stack as w,Card as j,Button as S,Flex as P,Text as T,TextInput as x,Popover as I,Badge as A}from"@sanity/ui";import{styled as D}from"styled-components";const k=(e,t,n)=>!e.name.startsWith("locale")||n.includes(t.name);function C(e,t){var n,r;const o=function(e){return"object"===(null==e?void 0:e.jsonType)&&"document"===F(e).name}(e)&&(null==(n=null==e?void 0:e.options)?void 0:n.languageFilter),l=!t.documentTypes;return!!(l&&!1!==o||!l&&o||e&&null!=(r=t.documentTypes)&&r.includes(e.name))}function F(e){return e.type?F(e.type):e}const N="@sanity/plugin/language-filter/selected-languages";function E(e){const t=z(e).map((e=>e.id));let n=t;try{const e=window.localStorage.getItem(N);e&&(n=JSON.parse(e))}catch(e){}return r=t,n=n.filter((e=>r.includes(e))),n;var r}function z({supportedLanguages:e,defaultLanguages:t}){return Array.isArray(e)?e.filter((e=>!(null!=t&&t.includes(e.id)))):[]}var J=Object.defineProperty,V=Object.defineProperties,$=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,q=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,B=(e,t)=>{for(var n in t||(t={}))H.call(t,n)&&q(e,n,t[n]);if(_)for(var n of _(t))W.call(t,n)&&q(e,n,t[n]);return e};const G={options:{apiVersion:"2022-11-27",supportedLanguages:[],defaultLanguages:[],documentTypes:[],filterField:k},selectedLanguageIds:[],setSelectedLanguageIds:()=>console.error("LanguageFilterStudioContext not initialized")},K=o(G);function M(t){const n=u({apiVersion:"2023-01-01"}),[o,i]=r(Array.isArray(t.options.supportedLanguages)?t.options.supportedLanguages:[]);l((()=>{let e=[];Array.isArray(t.options.supportedLanguages)||async function(t){e=await t(n,{}),i(e)}(t.options.supportedLanguages)}),[n,t.options.supportedLanguages]);const s=a((()=>{return e=B(B({},G.options),t.options),V(e,$({supportedLanguages:o}));var e}),[t.options,o]),[c,d]=function(e){return r((()=>{var t;return[...null!=(t=e.defaultLanguages)?t:[],...E(e)]}))}(s);return e(K.Provider,{value:{options:s,selectedLanguageIds:c,setSelectedLanguageIds:d},children:t.renderDefault(t)})}function Q(){return i(K)}const R=e=>Array.from(new Set(e));function U(){const{selectedLanguageIds:e,setSelectedLanguageIds:t,options:n}=Q(),{defaultLanguages:r=[]}=n,o=a((()=>z(n)),[n]),l=s((e=>{var n;t(R([...r,...e])),n=R([...r,...e]),window.localStorage.setItem(N,JSON.stringify(n))}),[r,t]),i=s((()=>l(o.map((e=>e.id)))),[l,o]),u=s((()=>{l(r)}),[r,l]),c=s((t=>{let n=e;n=n.includes(t)?n.filter((e=>e!==t)):R([...n,t]),l(n)}),[l,e]);return{activeLanguages:a((()=>R([...null!=r?r:[],...e])),[r,e]),allSelected:e.length===o.length+r.length,selectAll:i,selectNone:u,toggleLanguage:c}}const X=D(L)`
  max-height: calc(100vh - 200px);
`;function Y(){const{options:o}=Q(),l=o.supportedLanguages.filter((e=>{var t;return null==(t=o.defaultLanguages)?void 0:t.includes(e.id)})),a=o.supportedLanguages.filter((e=>{var t;return!(null!=(t=o.defaultLanguages)&&t.includes(e.id))})),[i,u]=r(!1),{activeLanguages:d,allSelected:p,selectAll:g,selectNone:f,toggleLanguage:h}=U(),[v,A]=r(null),[D,k]=r(null),C=s((e=>{"ALL"===e.currentTarget.value?g():f()}),[g,f]),F=s((()=>u((e=>!e))),[]),N=s((()=>u(!1)),[]);O(N,[v,D]);const E=o.supportedLanguages.length,[z,J]=r(""),V=s((e=>{e.currentTarget.value?J(e.currentTarget.value):J("")}),[]),$=E>4,_=e(X,{overflow:"auto",children:t(w,{padding:1,space:1,children:[l.length>0&&t(n,{children:[l.map((t=>e(Z,{id:t.id,title:t.title,selected:!0},t.id))),e(j,{borderTop:!0})]}),e(S,{mode:"bleed",onClick:C,justify:"flex-start",value:p?"NONE":"ALL",disabled:!!z,children:t(P,{gap:3,align:"center",children:[e(T,{size:2,children:p?e(c,{tone:"primary",children:e(m,{})}):e(y,{})}),e(L,{flex:1,children:e(T,{children:p?"Hide all":"Show all"})})]})}),$?e(x,{onChange:V,value:z,placeholder:"Filter languages"}):e(j,{borderTop:!0}),a.filter((e=>!z||e.title.toLowerCase().includes(z.toLowerCase()))).map((t=>e(Z,{id:t.id,onToggle:h,selected:d.includes(t.id),title:t.title},t.id)))]})}),H=d.length===E?"Showing all":`Showing ${d.length} / ${E}`;return e(I,{animate:!0,content:_,open:i,portal:!0,ref:k,children:e(S,{text:H,icon:b,mode:"bleed",onClick:F,ref:A,selected:i})})}function Z(n){const{id:r,onToggle:o,selected:l,title:a}=n,i=s((()=>{o&&o(r)}),[r,o]),u=!o;return e(S,{mode:"bleed",onClick:i,justify:"flex-start",disabled:u,children:t(P,{gap:3,align:"center",children:[e(T,{size:2,children:l?e(c,{tone:u?"default":"positive",children:e(h,{})}):e(v,{})}),e(L,{flex:1,children:e(T,{children:a})}),e(A,{children:r})]})})}var ee=Object.defineProperty,te=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,ae=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ie=(e,t)=>{for(var n in t||(t={}))oe.call(t,n)&&ae(e,n,t[n]);if(re)for(var n of re(t))le.call(t,n)&&ae(e,n,t[n]);return e},se=(e,t)=>te(e,ne(t)),ue=(e,t)=>{var n={};for(var r in e)oe.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&re)for(var r of re(e))t.indexOf(r)<0&&le.call(e,r)&&(n[r]=e[r]);return n};function ce(e){const t=e,{members:n,schemaType:r,renderDefault:o}=t,l=ue(t,["members","schemaType","renderDefault"]),{selectedLanguageIds:i,options:s}=Q(),{filterField:u}=s,c=a((()=>n.filter((e=>"field"===e.kind&&u(r,e,i)||"fieldSet"===e.kind||"error"===e.kind)).map((e=>"fieldSet"===e.kind?se(ie({},e),{fieldSet:se(ie({},e.fieldSet),{members:e.fieldSet.members.filter((e=>"field"===e.kind&&u(r,e,i)))})}):e))),[r,n,u,i]);return o(se(ie({},l),{members:c,schemaType:r,renderDefault:o}))}var de=Object.defineProperty,pe=Object.defineProperties,ge=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertySymbols,me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,be=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,he=(e,t)=>{for(var n in t||(t={}))me.call(t,n)&&be(e,n,t[n]);if(fe)for(var n of fe(t))ye.call(t,n)&&be(e,n,t[n]);return e};const ve=g((t=>{const n=()=>e(Y,{}),r=he(he({},G.options),t);return{name:"@sanity/language-filter",studio:{components:{layout:e=>{return M((t=he({},e),pe(t,ge({options:r}))));var t}}},document:{unstable_languageFilter:(e,{schemaType:r,schema:o})=>C(o.get(r),t)?[...e,n]:e},form:{components:{input:t=>"root"!==t.id&&f(t.schemaType)?function(t){const{options:n}=Q(),r=d(["_type"]);return C(p().get(r),n)?e(ce,ie({},t)):t.renderDefault(t)}(t):t.renderDefault(t)}}}}));export{k as defaultFilterField,C as isLanguageFilterEnabled,ve as languageFilter,Q as useLanguageFilterStudioContext};//# sourceMappingURL=index.mjs.map
