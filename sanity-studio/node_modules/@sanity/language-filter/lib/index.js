"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),r=require("@sanity/icons"),a=require("@sanity/ui"),l=require("styled-components");const s=(e,t,n)=>!e.name.startsWith("locale")||n.includes(t.name);function o(e,t){var n,r;const a=function(e){return"object"===(null==e?void 0:e.jsonType)&&"document"===i(e).name}(e)&&(null==(n=null==e?void 0:e.options)?void 0:n.languageFilter),l=!t.documentTypes;return!!(l&&!1!==a||!l&&a||e&&null!=(r=t.documentTypes)&&r.includes(e.name))}function i(e){return e.type?i(e.type):e}const u="@sanity/plugin/language-filter/selected-languages";function c(e){const t=d(e).map((e=>e.id));let n=t;try{const e=window.localStorage.getItem(u);e&&(n=JSON.parse(e))}catch(e){}return r=t,n=n.filter((e=>r.includes(e))),n;var r}function d({supportedLanguages:e,defaultLanguages:t}){return Array.isArray(e)?e.filter((e=>!(null!=t&&t.includes(e.id)))):[]}var g=Object.defineProperty,p=Object.defineProperties,f=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,b=(e,t,n)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))x.call(t,n)&&b(e,n,t[n]);if(m)for(var n of m(t))y.call(t,n)&&b(e,n,t[n]);return e};const h={options:{apiVersion:"2022-11-27",supportedLanguages:[],defaultLanguages:[],documentTypes:[],filterField:s},selectedLanguageIds:[],setSelectedLanguageIds:()=>console.error("LanguageFilterStudioContext not initialized")},v=t.createContext(h);function L(r){const a=n.useClient({apiVersion:"2023-01-01"}),[l,s]=t.useState(Array.isArray(r.options.supportedLanguages)?r.options.supportedLanguages:[]);t.useEffect((()=>{let e=[];Array.isArray(r.options.supportedLanguages)||async function(t){e=await t(a,{}),s(e)}(r.options.supportedLanguages)}),[a,r.options.supportedLanguages]);const o=t.useMemo((()=>{return e=j(j({},h.options),r.options),p(e,f({supportedLanguages:l}));var e}),[r.options,l]),[i,u]=function(e){return t.useState((()=>{var t;return[...null!=(t=e.defaultLanguages)?t:[],...c(e)]}))}(o);return e.jsx(v.Provider,{value:{options:o,selectedLanguageIds:i,setSelectedLanguageIds:u},children:r.renderDefault(r)})}function O(){return t.useContext(v)}const S=e=>Array.from(new Set(e));function C(){const{selectedLanguageIds:e,setSelectedLanguageIds:n,options:r}=O(),{defaultLanguages:a=[]}=r,l=t.useMemo((()=>d(r)),[r]),s=t.useCallback((e=>{var t;n(S([...a,...e])),t=S([...a,...e]),window.localStorage.setItem(u,JSON.stringify(t))}),[a,n]),o=t.useCallback((()=>s(l.map((e=>e.id)))),[s,l]),i=t.useCallback((()=>{s(a)}),[a,s]),c=t.useCallback((t=>{let n=e;n=n.includes(t)?n.filter((e=>e!==t)):S([...n,t]),s(n)}),[s,e]);return{activeLanguages:t.useMemo((()=>S([...null!=a?a:[],...e])),[a,e]),allSelected:e.length===l.length+a.length,selectAll:o,selectNone:i,toggleLanguage:c}}const T=l.styled(a.Box)`
  max-height: calc(100vh - 200px);
`;function w(){const{options:l}=O(),s=l.supportedLanguages.filter((e=>{var t;return null==(t=l.defaultLanguages)?void 0:t.includes(e.id)})),o=l.supportedLanguages.filter((e=>{var t;return!(null!=(t=l.defaultLanguages)&&t.includes(e.id))})),[i,u]=t.useState(!1),{activeLanguages:c,allSelected:d,selectAll:g,selectNone:p,toggleLanguage:f}=C(),[m,x]=t.useState(null),[y,b]=t.useState(null),j=t.useCallback((e=>{"ALL"===e.currentTarget.value?g():p()}),[g,p]),h=t.useCallback((()=>u((e=>!e))),[]),v=t.useCallback((()=>u(!1)),[]);a.useClickOutside(v,[m,y]);const L=l.supportedLanguages.length,[S,w]=t.useState(""),P=t.useCallback((e=>{e.currentTarget.value?w(e.currentTarget.value):w("")}),[]),I=L>4,F=e.jsx(T,{overflow:"auto",children:e.jsxs(a.Stack,{padding:1,space:1,children:[s.length>0&&e.jsxs(e.Fragment,{children:[s.map((t=>e.jsx(k,{id:t.id,title:t.title,selected:!0},t.id))),e.jsx(a.Card,{borderTop:!0})]}),e.jsx(a.Button,{mode:"bleed",onClick:j,justify:"flex-start",value:d?"NONE":"ALL",disabled:!!S,children:e.jsxs(a.Flex,{gap:3,align:"center",children:[e.jsx(a.Text,{size:2,children:d?e.jsx(n.TextWithTone,{tone:"primary",children:e.jsx(r.EyeClosedIcon,{})}):e.jsx(r.EyeOpenIcon,{})}),e.jsx(a.Box,{flex:1,children:e.jsx(a.Text,{children:d?"Hide all":"Show all"})})]})}),I?e.jsx(a.TextInput,{onChange:P,value:S,placeholder:"Filter languages"}):e.jsx(a.Card,{borderTop:!0}),o.filter((e=>!S||e.title.toLowerCase().includes(S.toLowerCase()))).map((t=>e.jsx(k,{id:t.id,onToggle:f,selected:c.includes(t.id),title:t.title},t.id)))]})}),A=c.length===L?"Showing all":`Showing ${c.length} / ${L}`;return e.jsx(a.Popover,{animate:!0,content:F,open:i,portal:!0,ref:b,children:e.jsx(a.Button,{text:A,icon:r.TranslateIcon,mode:"bleed",onClick:h,ref:x,selected:i})})}function k(l){const{id:s,onToggle:o,selected:i,title:u}=l,c=t.useCallback((()=>{o&&o(s)}),[s,o]),d=!o;return e.jsx(a.Button,{mode:"bleed",onClick:c,justify:"flex-start",disabled:d,children:e.jsxs(a.Flex,{gap:3,align:"center",children:[e.jsx(a.Text,{size:2,children:i?e.jsx(n.TextWithTone,{tone:d?"default":"positive",children:e.jsx(r.CheckmarkCircleIcon,{})}):e.jsx(r.CircleIcon,{})}),e.jsx(a.Box,{flex:1,children:e.jsx(a.Text,{children:u})}),e.jsx(a.Badge,{children:s})]})})}var P=Object.defineProperty,I=Object.defineProperties,F=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,B=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t)=>{for(var n in t||(t={}))D.call(t,n)&&B(e,n,t[n]);if(A)for(var n of A(t))E.call(t,n)&&B(e,n,t[n]);return e},N=(e,t)=>I(e,F(t)),M=(e,t)=>{var n={};for(var r in e)D.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&A)for(var r of A(e))t.indexOf(r)<0&&E.call(e,r)&&(n[r]=e[r]);return n};function _(e){const n=e,{members:r,schemaType:a,renderDefault:l}=n,s=M(n,["members","schemaType","renderDefault"]),{selectedLanguageIds:o,options:i}=O(),{filterField:u}=i,c=t.useMemo((()=>r.filter((e=>"field"===e.kind&&u(a,e,o)||"fieldSet"===e.kind||"error"===e.kind)).map((e=>"fieldSet"===e.kind?N(q({},e),{fieldSet:N(q({},e.fieldSet),{members:e.fieldSet.members.filter((e=>"field"===e.kind&&u(a,e,o)))})}):e))),[a,r,u,o]);return l(N(q({},s),{members:c,schemaType:a,renderDefault:l}))}var z=Object.defineProperty,V=Object.defineProperties,W=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,G=(e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,K=(e,t)=>{for(var n in t||(t={}))$.call(t,n)&&G(e,n,t[n]);if(J)for(var n of J(t))H.call(t,n)&&G(e,n,t[n]);return e};const Q=n.definePlugin((t=>{const r=()=>e.jsx(w,{}),a=K(K({},h.options),t);return{name:"@sanity/language-filter",studio:{components:{layout:e=>{return L((t=K({},e),V(t,W({options:a}))));var t}}},document:{unstable_languageFilter:(e,{schemaType:n,schema:a})=>o(a.get(n),t)?[...e,r]:e},form:{components:{input:t=>"root"!==t.id&&n.isObjectSchemaType(t.schemaType)?function(t){const{options:r}=O(),a=n.useFormValue(["_type"]);return o(n.useSchema().get(a),r)?e.jsx(_,q({},t)):t.renderDefault(t)}(t):t.renderDefault(t)}}}}));exports.defaultFilterField=s,exports.isLanguageFilterEnabled=o,exports.languageFilter=Q,exports.useLanguageFilterStudioContext=O;//# sourceMappingURL=index.js.map
